<?xml version='1.0' encoding='UTF-8' ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:cc="http://java.sun.com/jsf/composite">

    <cc:interface>

        <cc:attribute name="value" default="dropDown"
                      shortDescription="Element caption"/>

        <cc:attribute name="type" default="button"
                      shortDescription="Component type: button or link"/>

        <cc:attribute name="title" default=""
                      shortDescription="title"/>

        <cc:attribute name="styleClass" default=""
                      shortDescription="Style class"/>

        <cc:attribute name="popupStyleClass" default=""
                      shortDescription="Popup style class"/>

        <cc:attribute name="popupStyle" default=" border-left: black outset 2px;  border-right: black outset 2px;  border-bottom: black outset 2px; background-color: #eeeeee"
                      shortDescription="Popup style"/>

        <cc:attribute name="disable" type="java.lang.Boolean"
                      shortDescription="Disabled element"/>

        <cc:attribute name="render" type="java.lang.Boolean" default="true"
                      shortDescription="Render element"/>

    </cc:interface>

    <cc:implementation>

        <ice:panelGroup style="margin: 0; padding: 0"
                        rendered="#{cc.attrs.render}">

            <ice:commandLink id="link"
                             rendered="#{cc.attrs.type == 'link'}"
                             value="#{cc.attrs.value}"
                             title="#{cc.attrs.title}"
                             styleClass="#{cc.attrs.styleClass}"
                             disabled="#{cc.attrs.disable}"
                             onmouseout="jQuery('#{dropDownBean.jqPrefix}popup').trigger('controlMouseOut');"
                             onclick="jQuery('#{dropDownBean.jqPrefix}popup').trigger('controlClick', [this]);"/>

            <ice:commandButton id="button"
                               rendered="#{cc.attrs.type == 'button'}"
                               value="#{cc.attrs.value}"
                               title="#{cc.attrs.title}"
                               styleClass="#{cc.attrs.styleClass}"
                               disabled="#{cc.attrs.disable}"
                               onmouseout="jQuery('#{dropDownBean.jqPrefix}popup').trigger('controlMouseOut');"
                               onclick="jQuery('#{dropDownBean.jqPrefix}popup').trigger('controlClick', [this]);"/>

            <div id="#{dropDownBean.clientId}:popup"
                 style="display: none; #{cc.attrs.popupStyle};"
                 class="#{cc.attrs.popupStyleClass}">

                <cc:insertChildren/>

                <script type="text/javascript">
                    // <![CDATA[

                    jQuery(document).ready(function () {

                        jQuery('#{dropDownBean.jqPrefix}popup')
                            .bind('mouseleave', function(event) {
                                var p = jQuery(this);
                                if (p.is(':visible')) {
                                    p.hide('fast');
                                }
                            })
                            .bind('controlMouseOut', function(event) {
                                var p = jQuery(this);
                                if (p.is(':visible')) {
                                    if (!p.data("first")) {
                                        p.hide('fast');
                                    } else {
                                        p.data("first", false);
                                    }
                                }
                            })
                            .bind('controlClick', function(event, control) {
                                var p = jQuery(this);
                                if (!p.is(':visible')) {
                                    var c = jQuery(control);
                                    p.data("first", true);
                                    p.css("top", c.position().top + c.outerHeight(true))
                                        .css("left", c.position().left + 5)
                                        .show('fast');
                                } else {
                                    p.hide('fast');
                                }
                            })
                            .css("position", "absolute");

                        ice.onBeforeUpdate(function() {
                            var p = jQuery('#{dropDownBean.jqPrefix}popup');
                            if (p.is(':visible')) {
                                if (!p.data("first")) {
                                    p.hide('fast');
                                }
                            }
                        });

                    });
                    //]]>
                </script>
            </div>
        </ice:panelGroup>

    </cc:implementation>
</html>
