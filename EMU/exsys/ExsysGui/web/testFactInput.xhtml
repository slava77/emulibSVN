<?xml version='1.0' encoding='UTF-8' ?>

<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:icecore="http://www.icefaces.org/icefaces/core"
    xmlns:ace="http://www.icefaces.org/icefaces/components"
    xmlns:ice="http://www.icesoft.com/icefaces/component"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    template="resources/main.xhtml"
    xmlns:component="http://java.sun.com/jsf/composite/component">

    <ui:define name="menu">

    </ui:define>

    <ui:define name="pageTitle">
        <h:outputText value="Testing Fact Collection input services"/>
    </ui:define>

    <ui:define name="content">
        <ice:panelGroup styleClass="sectionTitle">
            Fact Input service
        </ice:panelGroup>
        <ice:form>
            <table width="100%" cellpadding="5" cellspacing="5">
                <tr>
                    <td colspan="2">
                        Type:
                        <input type="radio" name="testType" value="post" checked="1"/> POST
                        <input type="radio" name="testType" value="soap"/> SOAP
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table>
                            <tr>
                                <td>Default URLs:</td>
                                <td>
                                    <a href="#" help="post" onclick="setUrl('/ExsysGui/factcollectioninput');">/ExsysGui/factcollectioninput</a>
                                    <a href="#" help="soap" onclick="setUrl('/cdw/factcollection');">/ExsysGui/factcollectioninput</a>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table>
                            <tr>
                                <td>URL:</td>
                                <td>
                                  <input id="testUrl" type="text" value="/ExsysGui/factcollectioninput" size="50"/>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td width="50%">Type in or paste a Fact Collection XML below:</td>
                    <td width="50%">Result:</td>
                </tr>
                <tr>
                    <td width="50%">
                        <textarea id="testXml" style="width: 100%; height: 400px"></textarea>
                    </td>
                    <td width="50%">
                        <div id="testResult" style="width: 100%; height: 400px; overflow: scroll; border-style: inset; border-width: 5px; padding: 5px; border-color: white"/>
                    </td>
                </tr>
                <tr>
                    <td width="50%">
                        <input id="testSendButton" type="button" value="Send"/>
                    </td>
                    <td width="50%">
                        <input id="testClearButton" type="button" value="Clear"/>
                    </td>
                </tr>
            </table>

            <script type="text/javascript">
                // <![CDATA[

                function setUrl(url) {
                  jQuery("#testUrl").val(url);
                }

                jQuery(document).ready( function () {

                    jQuery("input[name=testType]:radio").click(function(o) {
                        var v = jQuery("input[name=testType]:radio:checked").val();
                        jQuery("a[help]").hide();
                        jQuery("a[help=" + v + "]").show();
                        jQuery("a[help=" + v + "]:first").click();
                    });

                    jQuery("#testUrlTestButton").click(function() {
                        window.open(jQuery("#testUrl").val());
                    });

                    jQuery("#testClearButton").click(function() {
                        jQuery("#testResult").html("").css("border-color", "white");
                    });

                    jQuery("#testSendButton").click(function() {
                        var url = jQuery("#testUrl").val();
                        var xml = jQuery("#testXml").val();
                        var typ = jQuery("input[name=testType]:radio:checked").val();

                        if (typ == 'soap') {
                          xml = '<soap-env:Envelope soap-env:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soap-env="http://schemas.xmlsoap.org/soap/envelope/">'
                                + '<soap-env:Header/>'
                                + '<soap-env:Body>'
                                    + '<ws:input xmlns:ws="http://www.cern.ch/cms/csc/dw/ws/factCollectionInput">'
                                      + xml
                                    + '</ws:input>'
                                + '</soap-env:Body>'
                              + '</soap-env:Envelope>';
                        }

                        jQuery.ajax({
                          type: 'POST',
                          contentType: 'text/xml',
                          url: url,
                          data: xml,
                          async: false,
                          dataType: 'html',
                          success:
                              function(res) {
                                if (typ == 'soap') {
                                  jQuery("#testResult").text(res);
                                }
                                if (typ == 'post') {
                                  jQuery("#testResult").html(res);
                                }
                                jQuery("#testResult").css("border-color", "green");
                              },
                          error:
                              function(xhr, status, error) {
                                if (typ == 'soap') {
                                  jQuery("#testResult").text(xhr.responseText);
                                }
                                if (typ == 'post') {
                                  jQuery("#testResult").html(xhr.responseText);
                                }
                                jQuery("#testResult").css("border-color", "red");
                              }
                        });

                    });

                  jQuery("input[name=testType]:radio:checked").click();

                });
                // ]]>
            </script>

        </ice:form>
    </ui:define>

</ui:composition>
