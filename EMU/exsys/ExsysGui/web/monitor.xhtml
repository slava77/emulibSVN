<?xml version='1.0' encoding='UTF-8' ?>

<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:icecore="http://www.icefaces.org/icefaces/core"
    xmlns:ace="http://www.icefaces.org/icefaces/components"
    xmlns:ice="http://www.icesoft.com/icefaces/component"
    xmlns:h="http://java.sun.com/jsf/html"
    template="resources/main.xhtml"
    xmlns:exsys-component="http://java.sun.com/jsf/composite/component"
    xmlns:exsys-util="http://java.sun.com/jsf/composite/component/util">

    <ui:define name="menu">
    </ui:define>

    <ui:define name="pageTitle">
        Service Monitor
    </ui:define>

    <ui:define name="content">
        <ice:form>

            <ice:panelGrid columns="1">

                <ice:panelGrid columns="4" cellpadding="10" columnClasses="columnTop">

                    <ice:panelGroup>
                        <ice:panelGroup styleClass="sectionTitle">
                            <h:outputText value="General"/>
                        </ice:panelGroup>
                        <!--ice:panelGrid columns="2">
                            <ice:outputLabel value="OS:"/>
                            <ice:outputText value="#{monitorController.sysMonitor.osName}"/>
                            <ice:outputLabel value="Number of CPUs:"/>
                            <ice:outputText value="#{monitorController.sysMonitor.numCpus}"/>
                            <ice:outputLabel value="Up time:"/>
                            <ice:outputText value="#{monitorController.sysMonitor.upTime}"/>
                            <ice:outputLabel value="CPU usage:"/>
                            <ice:outputText value="#{monitorController.sysMonitor.cpuUsage}"/>
                            <ice:outputLabel value="RAM:"/>
                            <ice:outputText value="#{monitorController.sysMonitor.ram}"/>
                            <ice:outputLabel value="Swap:"/>
                            <ice:outputText value="#{monitorController.sysMonitor.swap}"/>
                            <ice:outputLabel value="Current PID:"/>
                            <ice:outputText value="#{monitorController.sysMonitor.currentPid}"/>
                        </ice:panelGrid-->
                    </ice:panelGroup>

                    <ice:panelGroup>
                        <ice:panelGroup styleClass="sectionTitle">
                            <h:outputText value="Database"/>
                        </ice:panelGroup>
                        <ice:panelGrid columns="2">
                            <ice:outputLabel value="Status:"/>
                            <ice:outputText value="OK" rendered="#{monitorController.databaseDate != null}" style="color: green"/>
                            <ice:outputText value="Not OK" rendered="#{monitorController.databaseDate == null}" style="color: red"/>
                            <ice:outputLabel value="Sysdate:"/>
                            <ice:outputText value="#{monitorController.databaseDate}"/>
                        </ice:panelGrid>
                    </ice:panelGroup>

                    <ice:panelGroup>
                        <ice:panelGroup styleClass="sectionTitle">
                            <h:outputText value="Queues"/>
                        </ice:panelGroup>
                        <ice:dataTable value="#{monitorController.queues}" var="q" varStatus="status">
                            <ice:column>
                                <f:facet name="header">
                                    <ice:outputLabel value="Name"/>
                                </f:facet>
                                <ice:outputText value="#{q.name}"/>
                            </ice:column>
                            <ice:column>
                                <f:facet name="header">
                                    <ice:outputLabel value="Size"/>
                                </f:facet>
                                <ice:outputText value="#{q.size}"/>
                            </ice:column>
                            <ice:column>
                                <f:facet name="header">
                                    <ice:outputLabel value="Message"/>
                                </f:facet>
                                <ice:commandLink value="flush" actionListener="#{monitorController.flushQueueMessageListener}">
                                    <f:param name="index" value="#{status.index}"/>
                                </ice:commandLink>
                            </ice:column>
                        </ice:dataTable>
                    </ice:panelGroup>

                    <ice:panelGroup>
                        <ice:panelGroup styleClass="sectionTitle">
                            <h:outputText value="Chart"/>
                        </ice:panelGroup>
                        <ice:outputLabel value="Last hours"/>
                        <ice:selectOneMenu value="#{monitorController.chartLastHours}" immediate="true" partialSubmit="true">
                            <f:selectItems value="#{monitorController.chartLastHoursItems}"/>
                        </ice:selectOneMenu>
                        <ice:panelGroup>
                            <ice:commandLink value="Refresh"
                                             actionListener="#{monitorController.refreshAllImagesListener}"/>
                            <ice:panelGroup>
                                <ice:outputLabel value="Live refresh"/>
                                <exsys-component:polling interval="#{monitorController.refreshInterval}"
                                                         run="#{monitorController.refreshInterval &gt; 0}"
                                                         actionListener="#{monitorController.refreshAllImagesListener}"/>
                                <ice:selectOneMenu value="#{monitorController.refreshInterval}"
                                                   partialSubmit="true"
                                                   immediate="true">
                                    <f:selectItem itemValue="0"   itemLabel="Off"/>
                                    <f:selectItem itemValue="10"  itemLabel="10 sec."/>
                                    <f:selectItem itemValue="20"  itemLabel="20 sec."/>
                                    <f:selectItem itemValue="40"  itemLabel="40 sec."/>
                                    <f:selectItem itemValue="60"  itemLabel="01 min."/>
                                    <f:selectItem itemValue="120" itemLabel="02 min."/>
                                    <f:selectItem itemValue="180" itemLabel="03 min."/>
                                </ice:selectOneMenu>
                            </ice:panelGroup>
                        </ice:panelGroup>
                    </ice:panelGroup>

                </ice:panelGrid>

                <ice:panelGroup>

                    <ice:graphicImage value="#{monitorController.statusImage}"/>

                </ice:panelGroup>

                <ice:panelGroup>

                    <ice:graphicImage value="#{monitorController.systemImage}"/>

                </ice:panelGroup>

            </ice:panelGrid>

        </ice:form>
    </ui:define>

</ui:composition>
