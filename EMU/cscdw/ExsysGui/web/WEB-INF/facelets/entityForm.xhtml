<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ice="http://www.icesoft.com/icefaces/component"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:exs="http://www.cern.ch/cms/csc/exsys/gui"
      xmlns:u1="http://www.cern.ch/cms/csc/exsys/gui">

    <body>

        <ui:composition>
            <ice:commandButton value="Discard new value" action="#{manager.discardAndGoBack}"
                               rendered="#{(editor.inputType == 'SELECT_ONE_MENU') and (editor.valueNew)}"
                               immediate="true"/>
            <ice:commandButton value="Go back" action="#{manager.goBack}"
                               rendered="#{editor.parentEditor != null}"/>

            <p><h2><ice:outputText value="#{editor.metadata.title}:" rendered="#{editor.parentEditor != null}"/></h2></p>

            <ice:panelGrid columns="3" styleClass="editorTable">
                <c:forEach var="propEditor" items="#{editor.propertyEditors}">

                    <ice:outputLabel for="input_#{propEditor.id}">
                        <ice:outputText value="#{propEditor.metadata.title}: " rendered="#{propEditor.metadata != null}"/>
                    </ice:outputLabel>
                    <ice:panelGrid columns="1" style="width: 100%">
                        <!-- DEFAULT editor - simple inputText -->
                        <ice:inputText id="input_#{propEditor.id}" value="#{propEditor.value}" partialSubmit="true"
                                       converter="#{propEditor.converter}"
                                       validator="#{propEditor.validate}"
                                       required="#{propEditor.metadata.isMandatory}"
                                       requiredMessage="This field is mandatory - value cannot be blank"
                                       styleClass="simpleEditor"
                                       rendered="#{propEditor.inputType == 'DEFAULT'}"/>

                        <!-- TEXT_AREA editor - used for larger string properties -->
                        <ice:inputTextarea id="input_#{propEditor.id}" value="#{propEditor.value}" partialSubmit="true"
                                           converter="#{propEditor.converter}"
                                           validator="#{propEditor.validate}"
                                           required="#{propEditor.metadata.isMandatory}"
                                           requiredMessage="This field is mandatory - value cannot be blank"
                                           styleClass="simpleEditor"
                                           style="height: 100px"
                                           rendered="#{propEditor.inputType == 'TEXT_AREA'}"/>

                        <!-- CHECKBOX editor - used for boolean properties -->
                        <ice:selectBooleanCheckbox id="input_#{propEditor.id}" value="#{propEditor.value}" partialSubmit="true"
                                                   converter="#{propEditor.converter}"
                                                   validator="#{propEditor.validate}"
                                                   required="#{propEditor.metadata.isMandatory}"
                                                   requiredMessage="This field is mandatory - value cannot be blank"
                                                   rendered="#{propEditor.inputType == 'CHECKBOX'}"/>

                        <!-- DATE_PICKER editor - used for date properties -->
                        <ice:selectInputDate id="input_#{propEditor.id}" value="#{propEditor.value}" partialSubmit="true"
                                             validator="#{propEditor.validate}"
                                             required="#{propEditor.metadata.isMandatory}"
                                             requiredMessage="This field is mandatory - value cannot be blank"
                                             renderAsPopup="true"
                                             rendered="#{propEditor.inputType == 'DATE_PICKER'}"/>

                        <!-- SELECT_ONE_MENU editor - used for enumerated properties and many-to-one relations -->
                        <ice:panelGroup rendered="#{propEditor.inputType == 'SELECT_ONE_MENU'}">
                            <ice:selectOneMenu id="input_#{propEditor.id}" value="#{propEditor.value}" partialSubmit="true"
                                               converter="#{propEditor.converter}"
                                               validator="#{propEditor.validate}"
                                               required="#{propEditor.metadata.isMandatory}"
                                               requiredMessage="This field is mandatory - value cannot be blank"
                                               styleClass="simpleEditor">
                                <f:selectItems value="#{propEditor.listOfValues}"/>
                            </ice:selectOneMenu>
                            <ice:commandButton value="Edit"
                                               immediate="true"
                                               rendered="#{!propEditor.restrictionStrict and !propEditor.metadata.isImmutableReference}">
                                <f:setPropertyActionListener target="#{manager.editor}" value="#{propEditor}"/>
                            </ice:commandButton>
                            <ice:commandButton value="Create New"
                                               immediate="true"
                                               actionListener="#{propEditor.createAndAssignNewLovItem}"
                                               rendered="#{!propEditor.restrictionStrict and !propEditor.metadata.isImmutableReference}">
                                <f:setPropertyActionListener target="#{manager.editor}" value="#{propEditor}"/>
                            </ice:commandButton>
                        </ice:panelGroup>

                        <!-- SELECT_MANY_LIST editor - used for many-to-many relations -->
                        <ice:panelGroup rendered="#{propEditor.inputType == 'SELECT_MANY_LIST'}">
                            <ice:selectManyListbox id="input_#{propEditor.id}" value="#{propEditor.valueAsArray}" partialSubmit="true"
                                               converter="#{propEditor.converter}"
                                               validator="#{propEditor.validate}"
                                               required="#{propEditor.metadata.isMandatory}"
                                               requiredMessage="This field is mandatory - value cannot be blank"
                                               styleClass="simpleEditor">
                                <f:selectItems value="#{propEditor.listOfValues}"/>
                            </ice:selectManyListbox>
                        </ice:panelGroup>

                        <!-- ONE-TO-ONE editor - input text just so that validation would be applied -->
                        <ice:panelGroup rendered="#{propEditor.inputType == 'ONE_TO_ONE'}">
                            <ice:inputText id="input_#{propEditor.id}" value="#{propEditor.value.entityTitle}"
                                           required="#{propEditor.metadata.isMandatory}"
                                           requiredMessage="This field is mandatory - value cannot be blank"
                                           validator="#{propEditor.validate}"
                                           readonly="true"
                                           styleClass="simpleEditor"
                                           partialSubmit="true"/>
                            <ice:commandButton type="submit" value="Edit"
                                               rendered="#{!propEditor.metadata.isImmutableReference}"
                                               immediate="true">
                                <f:setPropertyActionListener target="#{manager.editor}" value="#{propEditor}"/>
                            </ice:commandButton>
                        </ice:panelGroup>

                        <!-- COMPONENT editor - select input text -->
                        <ice:panelGrid columns="2"
                                       rendered="#{propEditor.inputType == 'COMPONENT'}">
                            <ice:panelGrid columns="1">
                                <ice:selectInputText id="input_#{propEditor.id}"
                                    rows="#{propEditor.matchesToDisplay}"
                                    width="300"
                                    value="#{propEditor.componentName}"
                                    valueChangeListener="#{propEditor.componentInputValueChanged}"
                                    listVar="cmp"
                                    required="#{propEditor.metadata.isMandatory}"
                                    requiredMessage="This field is mandatory - value cannot be blank"
                                    listValue="#{propEditor.componentMatches}">
                                    <f:facet name="selectInputText">
                                        <ice:panelGrid columns="2" columnClasses="componentMatchesName componentMatchesType">
                                            <ice:outputText value="#{cmp.name}"/>
                                            <ice:outputText value="#{cmp.type.type.value}" style="font-style: italic" />
                                        </ice:panelGrid>
                                    </f:facet>
                                </ice:selectInputText>
                                <ice:panelGroup rendered="#{propEditor.componentClassLimited}">
                                    <h:outputText value="Limited to class "/>
                                    <ice:panelSeries value="#{propEditor.componentClassLimit}" var="cc" varStatus="status">
                                        <h:outputText value="#{cc.type.value} "/>
                                        <ice:outputText value="," rendered="#{!(status.index == status.end)}"/>
                                    </ice:panelSeries>
                                </ice:panelGroup>
                            </ice:panelGrid>
                        </ice:panelGrid>

                        <!-- Error messages here -->
                        <h:message for="input_#{propEditor.id}" styleClass="error"/>
                    </ice:panelGrid>
                    <ice:panelGroup>
                        <ice:outputText value="*" rendered="#{propEditor.metadata.isMandatory}" styleClass="requiredFieldIndicator"/>
                    </ice:panelGroup>

                    <!-- Description -->
                    <ice:panelGrid rendered="#{propEditor.metadata.description != null}"/>
                    <ice:outputText value="#{propEditor.metadata.description}"
                                    rendered="#{propEditor.metadata.description != null}" styleClass="note"/>
                    <ice:panelGrid rendered="#{propEditor.metadata.description != null}"/>

                </c:forEach>
            </ice:panelGrid>
        </ui:composition>
                        
    </body>
</html>
