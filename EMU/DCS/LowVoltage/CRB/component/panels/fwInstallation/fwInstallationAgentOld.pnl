V 10
1
LANG:1 19 fwInstallationAgent
PANEL,117 190 609 545 N "_3DFace" 0
"main()
{
  int dpGetResult;
  string destinationDir;
  string tempString;

  DebugN(myModuleName());

  //FVR: 30/03/2006: Check user access rights to the para module
  if (!getUserPermission(5)){
  
   DebugN(\"ERROR: Sorry but you do no have sufficient rights on this system to run the FW Installation Tool.\");
	 ChildPanelOnCentralModal(\"vision/MessageInfo1\", \"ERROR\", makeDynString(\"$1:Sorry but you do no have sufficient rights\\non this system to run the FW Installation Tool.\"));
   //fwInstallation_disablePanel();
   btnExecuteNow.enabled = false;
   btnPostpone.enabled = false; 
   btnRemind.visible = true;
   //btnClose.enabled = true; 
   return;
  }
  else{ 
    DebugN(\"INFO: Checking user access rights returns OK\");
     btnExecuteNow.enabled = true;
     btnPostpone.enabled = true; 
     btnRemind.visible = true;  
  } 
  
	dpGetResult = dpGet(\"fwInstallationInfo.installationDirectoryPath:_original.._value\", destinationDir);
	
	if((destinationDir == \"\") || (dpGetResult == -1))
	{	
		// ask for the installation directory
			
		ChildPanelOnCentral(\"fwInstallation/fwInstallationSelectDirectory.pnl\", \"fwInstallation_SelectDirectory\", \"\");
	}
	
	dpGetResult = dpGet(\"fwInstallationInfo.installationDirectoryPath:_original.._value\", destinationDir);
	if((destinationDir != \"\") && (dpGetResult != -1))
	{
		destinationDir += \"/\";
	
		logFileName.text = destinationDir + \"/log/fwInstallation_\"+formatTime(\"%Y%m%d_%H%M%S\",getCurrentTime())+\".log\";
  }
  
    
  //FVR: 21/06/2006 ->Connect agent trigger
  fwInstallation_connectAgentTrigger();	
  
  refreshPanel();
  

  
}

void refreshPanel()
{
  dyn_dyn_string expiredRequests;

  while(1){
   
    fwInstallation_refreshPendingRequestsPanel(); 
    fwInstallation_getExpiredRequests(expiredRequests);
    if(dynlen(expiredRequests) == 0)
      btnClose.enabled = true;
    else
      btnClose.enabled = false;    
      
    delay(10);
  }

}
" 0
EE E E 1 0 0 0  12 10
"" 0 1
E"enablePanel()
{
  btnRemind.enabled = true;
  btnExecuteNow.enabled = true;
  btnPostpone.enabled = true;
  
}

disablePanel()
{
  btnRemind.enabled = false;
  btnExecuteNow.enabled = false;
  btnPostpone.enabled = false;  
}
" 0
 2
"CBRef""1"
"EClose"E
""
DISPLAY_LAYER, 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
LAYER, 0 
1
LANG:1 6 Layer1
2 1
"Text1"
""
1 12 10 E E E 1 E 1 E N {0,0,0} E N "_Transparent" E E
 E E
2 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 14 12 257 34
0 2 0 "0s" 0 0 0 192 0 0  14 12
 1
1
LANG:1 84 -*-Arial-*-r-normal-*-19-*-100-100-*-*-iso8859-1|-19,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
1
LANG:1 28 Framework Installation Agent
2 6
"logFileName"
""
1 175 390 E E E 0 E 0 E N {0,0,0} E N "_3DFace" E E
 E E
7 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
"main()
{
}" 0
 E 0 1 1 0 1 E U  1 E 177 392 593 418
0 2 0 "0s" 0 0 0 64 0 0  177 392
 1
1
LANG:1 94 -*-Courier New-*-r-normal-*-8-*-100-100-*-*-iso8859-1|-8,0,0,0,404,0,0,0,0,0,0,0,0,Courier New
0 ""
1
LANG:1 0 
2 8
"Text2"
""
1 20 50 E E E 1 E 1 E N "_WindowText" E N "_Transparent" E E
 E E
9 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 22 52 275 68
0 2 0 "0s" 0 0 0 192 0 0  22 52
 1
1
LANG:1 84 -*-Arial-*-r-normal-*-13-*-100-100-*-*-iso8859-1|-13,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
1
LANG:1 45 Pending installation/Uninstallation requests:
6 23
"Border1"
""
1 327 434 E E E 1 E 1 E N "_WindowText" E N {0,255,255} E E
 E E
14 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  1 E 327 424 397 434
2 24
"Text3"
""
1 401 418 E E E 1 E 1 E N "_WindowText" E N "_Transparent" E E
 E E
15 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 403 420 586 436
0 2 0 "s" 0 0 0 192 0 0  403 420
 1
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 30 Request execution time expired
17 4
"list"
""
1 30 300 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
5 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 84 -*-Arial-*-r-normal-*-13-*-100-100-*-*-iso8859-1|-13,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
28 298 592 412
0
E
E
E

3 1
25 16
"tblPendingRequests"
""
1 -6 0 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
10 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 106 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,0,0,0,0,Arial
0 ""
28 88 596 282
"main()
{

  this.tableMode(TABLE_SELECT_MULTIPLE);    
  this.selectByClick(TABLE_SELECT_LINE); 
 
  dpConnect(\"refreshCB\", \"fwInstallation_PendingInstallationRequests.action\");

}

void refreshCB(string dpe, dyn_string actions)
{
  fwInstallation_refreshPendingRequestsPanel();
}" 0
 E 1 0 1 4 1 "action" 0 1 0 "s" 1
LANG:1 6 Action
E1
LANG:1 24 Install/Delete Component
 128 "component" 0 1 0 "s" 1
LANG:1 9 Component
E1
LANG:1 14 Component Name
 128 "version" 0 1 0 "s" 1
LANG:1 7 Version
E1
LANG:1 17 Component Version
 128 "date" 0 1 0 "s" 1
LANG:1 19 Scheduled Execution
E1
LANG:1 17 Component Version
 160 26 26 "" 1 1
LANG:1 2 #1
8 30 1
LANG:1 106 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,0,0,0,0,Arial
0 ""
0 2 1 3 0
1 0
13 17
"btnPostpone"
""
1 461 454 E E E 1 E 1 E N {0,0,0} E N "_3DFace" E E
 E E
11 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 84 -*-Arial-*-r-normal-*-13-*-100-100-*-*-iso8859-1|-13,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
459 452 590 486
T 
1
LANG:1 18 Schedule Execution
"main()
{
  dyn_string pendingRequests;
  dyn_string pendingActions;
  dyn_string pendingRequestVersions;
  
  dyn_float df;
  dyn_string ds;

  dyn_int lines = tblPendingRequests.getSelectedLines();
  dyn_anytype pendingRequestInfo;
  
  if(dynlen(lines) <=0){
    ChildPanelOnCentral(\"vision/MessageInfo1\", \"ERROR\", \"$1:You must select the requests first in the table\");
    return;
  }
  
  for(int i = 1; i <= dynlen(lines); i++){

    getValue(\"tblPendingRequests\", \"getLineN\", lines[i], pendingRequestInfo);

//    DebugN(pendingRequestInfo);
    dynAppend(pendingActions, pendingRequestInfo[1]);
    dynAppend(pendingRequests, pendingRequestInfo[2]);
    dynAppend(pendingRequestVersions, pendingRequestInfo[3]);
  }

  ChildPanelOnCentralReturn(\"fwInstallation/fwInstallationScheduler.pnl\", \"Schedule Installation Date\", 
                            makeDynString(\"$actions:\" + pendingActions, \"$requests:\" + pendingRequests, \"$versions:\" + pendingRequestVersions), 
                            df, ds);
  
  if(dynlen(df)> 0 && df[1] == 1.){
    fwInstallation_refreshPendingRequestsPanel();
  }

/* int currentAttempt;
 int sleepFor;
 
 dpGet(\"fwInstallation_agentParametrization.currentAttempt\", currentAttempt,
       \"fwInstallation_agentParametrization.sleepFor\", sleepFor);
 
 dpSet(\"fwInstallation_agentParametrization.currentAttempt\", (currentAttempt + 1));
*/
}" 0
 E E "main()
{
  dpConnect(\"setEnabledCB\", \"fwInstallation_agentParametrization.maxAttempts\", \"fwInstallation_agentParametrization.currentAttempt\");

}
void setEnabledCB(string dpeMax, int maxAttempts, string currentDpe, int currentAttempt)
{      
 if(currentAttempt < maxAttempts)
   this.enabled = true;
 else
   this.enabled = false;
}
" 0

13 19
"btnExecuteNow"
""
1 188 454 E E E 1 E 1 E N {0,0,0} E N "_3DFace" E E
 E E
12 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 84 -*-Arial-*-r-normal-*-13-*-100-100-*-*-iso8859-1|-13,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
186 452 317 486
T 
1
LANG:1 15 Execute All Now
"main()
{
  int lines;
  int error;
  
  getValue(\"tblPendingRequests\", \"lineCount\", lines);
  
  if(lines > 0){
    disablePanel();
    error = fwInstallation_triggerPendingInstallationAgent();	  
    fwInstallation_refreshPendingRequestsPanel();
    enablePanel();    
  }  
  else
    dpSet(\"fwInstallation_agentParametrization.currentAttempt\", 0);

}

" 0
 E E E
13 20
"btnRemind"
""
1 50 454 E E E 1 E 1 E N {0,0,0} E N "_3DFace" E E
 E E
12 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 84 -*-Arial-*-r-normal-*-13-*-100-100-*-*-iso8859-1|-13,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
48 452 179 486
T 
1
LANG:1 15 Remind me later
"main()
{
  PanelOff();
}" 0
 E E E
13 21
"executeSelected"
""
1 325 454 E E E 1 E 1 E N {0,0,0} E N "_3DFace" E E
 E E
12 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 84 -*-Arial-*-r-normal-*-13-*-100-100-*-*-iso8859-1|-13,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
323 452 454 486
T 
1
LANG:1 16 Execute Selected
"main()
{
  dyn_int lines = tblPendingRequests.getSelectedLines();
  dyn_anytype pendingRequestInfo;
  
  if(dynlen(lines) <=0){
    ChildPanelOnCentral(\"vision/MessageInfo1\", \"ERROR\", \"$1:You must select the requests first in the table\");
    return;
  }
  
  for(int i = 1; i <= dynlen(lines); i++){
    getValue(\"tblPendingRequests\", \"getLineN\", lines[i], pendingRequestInfo);
    fwInstallation_executePendingInstallationRequest(pendingRequestInfo[1], pendingRequestInfo[2], pendingRequestInfo[3]);
  }

}

" 0
 E E E
13 22
"Button2"
""
1 560 20 E E E 1 E 1 E N {0,0,0} E N "_3DFace" E E
 E E
13 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 84 -*-Arial-*-r-normal-*-13-*-100-100-*-*-iso8859-1|-13,0,0,0,404,0,0,0,0,0,0,0,0,Arial
0 ""
558 18 588 46
P 
14215660
"pictures/help_2.xpm"
1
LANG:1 0 
"main()
{
	std_help(\"fwInstallation/fwInstallationAgent.html\");
}" 0
 E E E
13 25
"btnClose"
""
1 460 500 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
16 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
458 498 592 532
T 
1
LANG:1 5 Close
"main()
{
  PanelOff();
}" 0
 E E E
0
LAYER, 1 
1
LANG:1 6 Layer2
0
LAYER, 2 
1
LANG:1 6 Layer3
0
LAYER, 3 
1
LANG:1 6 Layer4
0
LAYER, 4 
1
LANG:1 6 Layer5
0
LAYER, 5 
1
LANG:1 6 Layer6
0
LAYER, 6 
1
LANG:1 6 Layer7
0
LAYER, 7 
1
LANG:1 6 Layer8
0
0