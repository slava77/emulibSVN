<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>EmuFarmer's Manual</title>
    <style type="text/css">
      span.buttonbox { 
      background-color: #dddddd;
      border: thin solid #000000;
      padding: 0px 5px 0px 5px;
      }      
    </style>    
  </head>
  <body>
    <h1>EmuFarmer's Manual</h1>
    <ul>
      <li>
	<h2>Operation</h2>
	<ol>
	  <li>
	    <p>If no Emu configuration file shows, or if you have modified it, 
	    <span class="buttonbox">recreate</span> it.</p>
	    <p>The Emu configuration file will (re)created by merging those listed in 
	    the file under "Recipe to create Emu configuration file".</p>
	  </li>
	  <li>
	    <p>Select processes to act on, and <span class="buttonbox">start</span> or
	    <span class="buttonbox">stop</span> or 
	    <span class="buttonbox">stop and restart</span> them.</p>
	    <p>When in doubt about a particular process, visit the JobControl instance
	    responsible for it by clicking on the link in the <em>host</em> column.
	    In JobControl you can view the processes' status and console output.</p>
	    <p>The link in the <em>port</em> column opens that process' hyperDAQ page.</p>
	  </li>
	</ol>
      </li>
      <li>
	<h2>Configuration</h2>
	<ul>
	  <li>
	    <h3>Configuring the EmuFarmer application</h3>
	    <p>The configuration file of EmuFarmer should look like this 
	    <a href="../xml/EmuFarmer.xml" target="_blank">example</a>.</p>
	    <p>The 'configFilesList' property contains the link to the XML file 
	    that lists every subsystem's configuration file. 
	    EmuFarmer merges these into a single file <code>EmuConfig_YYYYMMDD_hhmmss_UTC.xml</code>,
	    and saves that in the directory 'mergedConfigDir'. This directory
	    is supposed to be accessible through the web at 'mergedConfigDirURL'.
	    EmuFarmer will instruct the JobControl servers to start XDAQ processes
	    with this merged configuration file.</p>
	  </li>
	  <li>
	    <h3>Configuring the Emu XDAQ processes</h3>
	    <p>To change the configuration of a particular Emu XDAQ process,
	    modify the configuration file pointed to by the appropriate 
	    item in the 'configFilesList' XML file. (If the URL is
	    <code>http://emudaq/cscdaq/config/...</code>, it is in <code>cscdaq@emudaq:config/...</code>;
	    otherwise you may have to find out 
	    yourself where it physically resides.) Do <em>not</em> modify
	    <code>EmuConfig_YYYYMMDD_hhmmss_UTC.xml</code> as it will not be used any more,
	    but a new version of it will be created and used instead.</p>
	  </li>
	</ul>
      </li>
      <li>
	<h2>Setup</h2>
	<p>Each host should have one JobControl process running on it. 
	(Of course, there can be any number of them on a host, but EmuFarmer will only deal with one 
	of them&#8212;the one specified in the config file <code>EmuFarmer.xml</code>)</p>
	<p>Moreover, on each host each user's directory should have a script to start
	the XDAQ executive. The name and location of this script is specified in the 
	'commandToStartXDAQ' element in <code>EmuFarmer.xml</code>. Its path is 
	relative to the user's home directory. Since this script will be run in a new, clean shell,
	<em>all</em> environment variables necessary for starting the executive must be defined in it. 
	(E.g., copy <code>$XDAQ_ROOT/daq/xdaq/scripts/xdaq.sh</code>, and specify in it 
	<code>XDAQ_ROOT</code> explicitly, without making reference to any environment variable, like this: 
	<code>export XDAQ_ROOT=/home/cscdaq/DAQKit/TriDAS</code>)</p>
      </li>
    </ul>
  </body>
</html>
