V 10
1
LANG:1 21 fwElmbCANBusCreateRef
PANEL,539 484 444 283 N "_3DFace" 1
"$sDpName"
EEE E E 1 -1 -1 0  0 0
"" 0 1
E"void pnlGetAvailablePortList(dyn_string &dsAvailablePortListKVASER, dyn_string &dsAvailablePortListNICAN)
{
// Local Variables
// ---------------
	int i;

	string sPortElement = \".interfacePort\";
	string sPort;
	string sCardElement = \".id\";
	string sCard;

	dyn_string dsAllocatedPortListKVASER;
	dyn_string dsAllocatedPortListNICAN;
	dyn_string dsAllPortListKVASER = makeDynString(\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\");
	dyn_string dsAllPortListNICAN = makeDynString(\"can0\",\"can1\",\"can2\",\"can3\",\"can4\",\"can5\",\"can6\",\"can7\",\"can8\",\"can9\",\"can10\",\"can11\",\"can12\",\"can13\",\"can14\",\"can15\");
	dyn_string dsExistingCANbusList;

	dyn_string exceptionInfo;

// Executable Code
// ---------------
	//Now we look at the ports already allocated by the existing CANbuses in the project								
	fwDevice_getChildren($sDpName, fwDevice_HARDWARE, dsExistingCANbusList, exceptionInfo);

	// Loop through all buses, finding the allocated ports;
	for (i = 1; i <= dynlen(dsExistingCANbusList); i++) {
		dpGet(dsExistingCANbusList[i] + sPortElement, sPort,
					dsExistingCANbusList[i] + sCardElement, sCard);
	
		if (sCard == ELMB_CAN_CARD_NICAN) {
			dynAppend(dsAllocatedPortListNICAN, sPort);
		} else {
			dynAppend(dsAllocatedPortListKVASER, sPort);
		}
	}

	// Loop through all allocated ports, removing them from the list
	for (i = 1; i <= dynlen(dsAllocatedPortListKVASER); i++) {
		dynRemove(dsAllPortListKVASER, dynContains(dsAllPortListKVASER, dsAllocatedPortListKVASER[i]));
	}
	
	// Loop through all allocated ports, removing them from the list
	for (i = 1; i <= dynlen(dsAllocatedPortListNICAN); i++) {
		dynRemove(dsAllPortListNICAN, dynContains(dsAllPortListNICAN, dsAllocatedPortListNICAN[i]));
	}
	
	dsAvailablePortListKVASER = dsAllPortListKVASER;
	dsAvailablePortListNICAN = dsAllPortListNICAN;

	return;
}

void pnlUpdateAvailablePorts()
{
// Local Variables
// ---------------
	dyn_string dsAvailablePortListKVASER;
	dyn_string dsAvailablePortListNICAN;

// Executable Code
// ---------------
	// Get all available ports
	pnlGetAvailablePortList(dsAvailablePortListKVASER, dsAvailablePortListNICAN);
	
	// Check the selection for the interface card type
	if (rdbInterfaceSelector.number == 1)
		cmbPortSelector.items = dsAvailablePortListNICAN;
	else
		cmbPortSelector.items = dsAvailablePortListKVASER;
	
	// Select the first entry as default
	cmbPortSelector.selectedPos(1);
	
	// Return to calling routine
	return;
}

void pnlCreateCANBus()
{
// Local Variables
// ---------------
  bool bIsRunning;
  bool bDefaultAddressing;
  
  int iBusSpeed;
  int iDriverNumber;
    
	string sPort;
	string sUserName;
	string sComment;
	string sCard;
	
	dyn_float df;
	
	dyn_string dsExceptionInfo;
	dyn_string ds;

// Executable Code
// ---------------
	// Check correct driver is running
	bIsRunning = fwElmbUser_checkDefaultDriver(iDriverNumber, dsExceptionInfo);
	if (dynlen(dsExceptionInfo) > 0) {
		fwExceptionHandling_display(dsExceptionInfo);
		return;
	} else if (!bIsRunning) {
		// Display panel indicating what the problem is and how to fix it
		ChildPanelOnCentralReturn(\"fwElmb/fwElmbDriverMessage.pnl\", 
															\"Warning\",
															makeDynString(\"$drvNum:\" + iDriverNumber),
															df, ds);
		return;
	}

 	// Warning for empty user name field
 	sUserName = txtUserName.text;
 	if ((sUserName == \"\")) {
		ChildPanelOnCentral(\"vision/MessageInfo1\",
												\"Warning\",
												makeDynString(\"Specify Bus Name\"));
		return;
	}

	// Now we read all information from the panel
	sComment = txtComment.text;	
	sPort = cmbPortSelector.text;
	iBusSpeed = cmbBusSpeedSelector.text;
	if (rdbInterfaceSelector.number == 1)
		sCard = ELMB_CAN_CARD_NICAN;
	else
		sCard = ELMB_CAN_CARD_KVASER;
	bDefaultAddressing = chbOpcAddressing.state(0);

	// Start progress bar to indicate system is busy
	fwOpenProgressBar(\"Create CAN Bus\", \"In progress. Please wait...\", 1);
		
	// Create bus
	fwElmbUser_createCANbus(sUserName,
													sComment,
													sPort,
													sCard,
													iBusSpeed,
													bDefaultAddressing,
													dsExceptionInfo);
	
	if (dynlen(dsExceptionInfo) > 0) {
		fwCloseProgressBar(sUserName + \" creation encountered errors\");
		fwExceptionHandling_display(dsExceptionInfo);
	} else {
		fwCloseProgressBar(sUserName + \" creation completed successfully\");
		lblLastSuccessfulCreate.text = sUserName;
	}	
	
	// Update available port in panel
	pnlUpdateAvailablePorts();

	// Return to calling routine
	return;
}" 0
 2
"CBRef""0"
"EClose"E
""
NC
DISPLAY_LAYER, 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
LAYER, 0 
1
LANG:1 6 Layer1
2 3
"txtTitle"
""
1 10 87 E E E 1 E 1 E N {0,0,0} E N "_Transparent" E E
 E E
5 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 12 12 166 36
0 2 0 "s" 0 0 0 64 0 0  12 12
 1
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-180-100-100-*-*-iso8859-1|-21,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 14 Create CAN Bus
2 2
"txtBusLabelCaption"
""
1 11 50 E E E 1 E 1 E N {0,0,0} E N "_Transparent" E E
 E E
6 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 13 52 112 70
0 2 0 "s" 0 0 0 64 0 0  13 52
 1
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 8 Bus Name
2 25
"lblBits"
""
1 365 148 E E E 1 E 1 E N {0,0,0} E N "_3DFace" E E
 E E
24 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  1 E 367 150 397 165
0 2 0 "s" 0 0 0 64 0 0  367 150
 1
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-110-100-100-*-*-iso8859-1|-12,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 6 bits/s
2 26
"lblComment"
""
1 11 80 E E E 1 E 1 E N {0,0,0} E N "_Transparent" E E
 E E
25 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 13 82 112 100
0 2 0 "s" 0 0 0 64 0 0  13 82
 1
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 7 Comment
30 32
"frmOpcAddressing"
""
1 11 241 E E E 1 E 1 E N "_3DText" E N "_Transparent" E E
 E E
30 0 0 0 0 0
EE E
1
1
LANG:1 0 
0
E E 0 1 1 0 1 E U  0 E 11 190 435 242
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 0 
30 39
"frmCardAndPort"
""
1 11 190 E E E 1 E 1 E N "_3DText" E N "_Transparent" E E
 E E
36 0 0 0 0 0
EE E
1
1
LANG:1 0 
0
E E 0 1 1 0 1 E U  0 E 11 116 242 190
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 29 Inteface Type and Port Number
30 40
"frmBusSpeed"
""
1 252 190 E E E 1 E 1 E N "_3DText" E N "_Transparent" E E
 E E
37 0 0 0 0 0
EE E
1
1
LANG:1 0 
0
E E 0 1 1 0 1 E U  0 E 252 116 435 190
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 9 Bus Speed
2 45
"lblLastSuccessfulCreate"
""
1 10 250 E E E 1 E 0 E N "_WindowText" E N "_Transparent" E E
 E E
40 0 0 0 0 0
EE E
0
1
LANG:1 0 
1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 12 252 198 268
1 2 0 "s" 0 0 0 64 0 0  12 252
 1
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
1
LANG:1 0 
14 1
"txtUserName"
""
1 131 46 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
2 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
129 44 433 71
3 "s" 0 0 0 0 0 0 
E
E
E
22 15
"cmbPortSelector"
""
1 157 146 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
14 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-110-100-100-*-*-iso8859-1|-12,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
155 144 219 170
0
"main()
{
	// Update available port in panel
	pnlUpdateAvailablePorts();
}" 0

E
E
 0 0
19 16
"rdbInterfaceSelector"
""
1 17 136 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
15 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-110-100-100-*-*-iso8859-1|-12,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
15 134 149 178
2
T 
1
LANG:1 6 Kvaser
 1
1
LANG:1 0 
 E  E  0 0 0 0 0
T 
1
LANG:1 15 National Instr.
 0
1
LANG:1 0 
 E  E  0 0 0 0 0
 1
E
"main(int button)
{
	// Update available port in panel
	pnlUpdateAvailablePorts();
}" 0

22 17
"cmbBusSpeedSelector"
""
1 281 146 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
16 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-110-100-100-*-*-iso8859-1|-12,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
279 144 363 170
7
1
LANG:1 5 10000
 0
1
LANG:1 5 20000
 0
1
LANG:1 5 50000
 0
1
LANG:1 6 125000
 1
1
LANG:1 6 250000
 0
1
LANG:1 6 500000
 0
1
LANG:1 7 1000000
 0
E
E
E
 0 0
14 27
"txtComment"
""
1 131 78 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
26 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
129 76 433 103
3 "s" 0 0 0 0 0 0 
E
E
E
20 35
"chbOpcAddressing"
""
1 18 199 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
33 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
16 197 213 241
1
T 
1
LANG:1 23 Default OPC addressing?
 1
1
LANG:1 0 
 E  E  0 0 0 0 0
1
E E 
E"main(int button, bool state)
{
	dyn_float df;
	dyn_string ds;
	
	if (!state) {
		ChildPanelOnCentralReturn(\"vision/MessageInfo3\",
															\"Question\",
															makeDynString(\"Unselecting this option you'll have to address\\nyour devices by hand.\\nAre you sure you want to do it?\", \"Yes\", \"No\", \"Cancel\"),
															df, ds);
		if (df[1]!= 1)
			this.state(button) = true;
		else if (df[1]==1)
			this.state(button) = false;
	}			

	return;
}" 0
1 46 0 "" 0
0
13 42
"cmdOK"
""
1 210 250 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
37 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
208 248 282 275
T 
1
LANG:1 2 OK
"main()
{
	string sText;
	pnlCreateCANBus();
	sText = lblLastSuccessfulCreate.text;
	if (strlen(sText) > 0)
		PanelOffReturn(makeDynFloat(1.0), makeDynString(lblLastSuccessfulCreate.text));
	else
		PanelOffReturn(makeDynFloat(0.0), makeDynString());
}" 0
 E E E
13 43
"cmdApply"
""
1 287 250 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
38 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
285 248 359 275
T 
1
LANG:1 5 Apply
"main()
{
	pnlCreateCANBus();
}" 0
 E E E
13 44
"cmdClose"
""
1 364 250 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
39 0 0 0 0 0
EE E
0
1
LANG:1 0 
0
1
LANG:1 107 -microsoft windows-Arial-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Arial
0 ""
362 248 436 275
T 
1
LANG:1 5 Close
"main()
{
	string sText;
	sText = lblLastSuccessfulCreate.text;
	if (strlen(sText) > 0)
		PanelOffReturn(makeDynFloat(1.0), makeDynString(lblLastSuccessfulCreate.text));
	else
		PanelOffReturn(makeDynFloat(0.0), makeDynString());
}" 0
 E E E
0
LAYER, 1 
1
LANG:1 6 Layer2
0
LAYER, 2 
1
LANG:1 6 Layer3
0
LAYER, 3 
1
LANG:1 6 Layer4
0
LAYER, 4 
1
LANG:1 6 Layer5
0
LAYER, 5 
1
LANG:1 6 Layer6
0
LAYER, 6 
1
LANG:1 6 Layer7
0
LAYER, 7 
1
LANG:1 6 Layer8
0
3 0 "Group3"
"objects\\fwGeneral\\fwHelpButton.pnl" 405 10 T 37 U  
1
"$sPanelRelativePath""fwElmb/fwElmbCANbusCreate"
0