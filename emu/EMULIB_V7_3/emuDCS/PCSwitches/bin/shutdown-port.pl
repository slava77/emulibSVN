#!/usr/local/bin/perl

use Net::Telnet;
$IP = shift @ARGV;
$port = shift @ARGV;
$telnet = new Net::Telnet (Port=>23, Timeout=>10, Errmode=>'die');
$telnet->open($IP);
$telnet->waitfor('/User:$/');
$telnet->print('admin');
$telnet->waitfor('/Password:$/');
$telnet->print('');
$telnet->waitfor('/\(GSM7212\) \>/');
$telnet->print('enable');
$telnet->waitfor('/Password:$/');
$telnet->print('');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('configure');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('interface 0/',$port);
$telnet->waitfor('/\)#/');
$telnet->print('auto-negotiate');
$telnet->waitfor('/\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \>/');
sleep 2;

$telnet->print('enable');
$telnet->waitfor('/Password:$/');
$telnet->print('');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('configure');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('interface 0/',$port);
$telnet->waitfor('/\)#/');
$telnet->print('shutdown');
$telnet->waitfor('/\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \>/');
sleep 2;

$telnet->print('enable');
$telnet->waitfor('/Password:$/');
$telnet->print('');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('configure');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('interface 0/',$port);
$telnet->waitfor('/\)#/');
$telnet->print('no shutdown');
$telnet->waitfor('/\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \>/');
sleep 2;
$telnet->print('enable');
$telnet->waitfor('/Password:$/');
$telnet->print('');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('configure');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('interface 0/',$port);
$telnet->waitfor('/\)#/');
$telnet->print('no auto-negotiate');
$telnet->waitfor('/\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \(Config\)#/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) #/');
$telnet->print('exit');
$telnet->waitfor('/\(GSM7212\) \>/');
$telnet->print('logout');
